!function ($) {
    function format(t) {
        for (var o = 1; o < arguments.length; o++) t = t.replace("%" + (o - 1), arguments[o]);
        return t
    }

    function CloudZoom(t, o) {
        var e, i, s, a, n, r, d, l, u = $("img", t), c = null, p = null, h = null, m = null, f = null, g = null, v = 0,
            x = 0, b = 0, y = 0, z = 0, w = 0, k = this;
        setTimeout(function () {
            if (null === p) {
                var o = t.width();
                t.parent().append(format('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>', o / 3, o / 2 - o / 6)).find(":last").css("opacity", .5)
            }
        }, 200);
        var O = function () {
            null !== g && (g.remove(), g = null)
        };
        this.removeBits = function () {
            h && (h.remove(), h = null), m && (m.remove(), m = null), f && (f.remove(), f = null), O(), $(".cloud-zoom-loading", t.parent()).remove()
        }, this.destroy = function () {
            t.data("zoom", null), p && (p.unbind(), p.remove(), p = null), c && (c.remove(), c = null), this.removeBits()
        }, this.fadedOut = function () {
            c && (c.remove(), c = null), this.removeBits()
        }, this.controlLoop = function () {
            if (h) {
                var t = r - u.offset().left - .5 * a >> 0, e = d - u.offset().top - .5 * n >> 0;
                t < 0 ? t = 0 : t > u.outerWidth() - a && (t = u.outerWidth() - a), e < 0 ? e = 0 : e > u.outerHeight() - n && (e = u.outerHeight() - n), h.css({
                    left: t,
                    top: e
                }), h.css("background-position", -t + "px " + -e + "px"), x = t / u.outerWidth() * s.width >> 0, b = e / u.outerHeight() * s.height >> 0, z += (x - z) / o.smoothMove, y += (b - y) / o.smoothMove, c.css("background-position", -(z >> 0) + "px " + -(y >> 0) + "px")
            }
            v = setTimeout(function () {
                k.controlLoop()
            }, 30)
        }, this.init2 = function (t, o) {
            w++, 1 === o && (s = t), 2 === w && this.init()
        }, this.init = function () {
            $(".cloud-zoom-loading", t.parent()).remove(), (p = t.parent().append(format("<div class='mousetrap' style='background-image:url(\".\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>", u.outerWidth(), u.outerHeight(), 0, 0)).find(":last")).bind("mousemove", this, function (t) {
                r = t.pageX, d = t.pageY
            }), p.bind("mouseleave", this, function (t) {
                return clearTimeout(v), h && h.fadeOut(299), m && m.fadeOut(299), f && f.fadeOut(299), c.fadeOut(300, function () {
                    k.fadedOut()
                }), !1
            }), p.bind("mouseenter", this, function (e) {
                r = e.pageX, d = e.pageY, l = e.data, c && (c.stop(!0, !1), c.remove());
                var i = o.adjustX, v = o.adjustY, x = u.outerWidth(), b = u.outerHeight(), y = o.zoomWidth,
                    z = o.zoomHeight;
                "auto" == o.zoomWidth && (y = x), "auto" == o.zoomHeight && (z = b);
                var w = t.parent();
                switch (o.position) {
                    case"top":
                        v -= z;
                        break;
                    case"right":
                        i += x;
                        break;
                    case"bottom":
                        v += b;
                        break;
                    case"left":
                        i -= y;
                        break;
                    case"inside":
                        y = x, z = b;
                        break;
                    default:
                        (w = $("#" + o.position)).length ? (y = w.innerWidth(), z = w.innerHeight()) : (w = t, i += x, v += b)
                }
                c = w.append(format('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"></div>', i, v, y, z, s.src)).find(":last"), u.attr("title") && o.showTitle && c.append(format('<div class="cloud-zoom-title">%0</div>', u.attr("title"))).find(":last").css("opacity", o.titleOpacity), $.browser.msie && $.browser.version < 7 && (g = $('<iframe frameborder="0" src="#"></iframe>').css({
                    position: "absolute",
                    left: i,
                    top: v,
                    zIndex: 99,
                    width: y,
                    height: z
                }).insertBefore(c)), c.fadeIn(500), h && (h.remove(), h = null), a = u.outerWidth() / s.width * c.width(), n = u.outerHeight() / s.height * c.height(), h = t.append(format("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>", a, n)).find(":last"), p.css("cursor", h.css("cursor"));
                var k = !1;
                o.tint && (h.css("background", 'url("' + u.attr("src") + '")'), (m = t.append(format('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />', u.outerWidth(), u.outerHeight(), o.tint)).find(":last")).css("opacity", o.tintOpacity), k = !0, m.fadeIn(500)), o.softFocus && (h.css("background", 'url("' + u.attr("src") + '")'), (f = t.append(format('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />', u.outerWidth() - 2, u.outerHeight() - 2, o.tint)).find(":last")).css("background", 'url("' + u.attr("src") + '")'), f.css("opacity", .5), k = !0, f.fadeIn(500)), k || h.css("opacity", o.lensOpacity), "inside" !== o.position && h.fadeIn(500), l.controlLoop()
            })
        }, e = new Image, $(e).load(function () {
            k.init2(this, 0)
        }), e.src = u.attr("src"), i = new Image, $(i).load(function () {
            k.init2(this, 1)
        }), i.src = t.attr("href")
    }

    $(document).ready(function () {
        $(".cloud-zoom, .cloud-zoom-gallery").CloudZoom()
    }), $.fn.CloudZoom = function (d) {
        try {
            document.execCommand("BackgroundImageCache", !1, !0)
        } catch (t) {
        }
        return this.each(function () {
            var c, opts;
            eval("var\ta = {" + $(this).attr("rel") + "}"), c = a, $(this).is(".cloud-zoom") ? ($(this).css({
                position: "relative",
                display: "block"
            }), $("img", $(this)).css({display: "block"}), "wrap" != $(this).parent().attr("id") && $(this).wrap('<div id="wrap" style="top:0px;z-index:9999;position:relative;"></div>'), opts = $.extend({}, $.fn.CloudZoom.defaults, d), opts = $.extend({}, opts, c), $(this).data("zoom", new CloudZoom($(this), opts))) : $(this).is(".cloud-zoom-gallery") && (opts = $.extend({}, c, d), $(this).data("relOpts", opts), $(this).bind("click", $(this), function (t) {
                var o = t.data.data("relOpts");
                return $("#" + o.useZoom).data("zoom").destroy(), $("#" + o.useZoom).attr("href", t.data.attr("href")), $("#" + o.useZoom + " img").attr("src", t.data.data("relOpts").smallImage), $("#" + t.data.data("relOpts").useZoom).CloudZoom(), !1
            }))
        }), this
    }, $.fn.CloudZoom.defaults = {
        zoomWidth: "auto",
        zoomHeight: "auto",
        position: "right",
        tint: !1,
        tintOpacity: .5,
        lensOpacity: .5,
        softFocus: !1,
        smoothMove: 3,
        showTitle: !0,
        titleOpacity: .5,
        adjustX: 0,
        adjustY: 0
    }
}(jQuery);