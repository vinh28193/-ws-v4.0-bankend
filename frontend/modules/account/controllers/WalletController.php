<?php


namespace frontend\modules\account\controllers;


use frontend\modules\payment\Payment;
use frontend\modules\payment\providers\wallet\WalletService;
use yii\helpers\ArrayHelper;

class WalletController extends BaseAccountController
{
    public function beforeAction($action)
    {
        $before = parent::beforeAction($action); // TODO: Change the autogenerated stub
        if(WalletService::isGuest()){
            return \Yii::$app->response->redirect('/my-weshop.html');
        }else{
            return $before;
        }
    }

    public function actionIndex(){
        $walletS = new WalletService();
        $wallet = ArrayHelper::getValue($walletS->detailWalletClient(),'data',[]);
        return $this->render('index',[
            'wallet' => $wallet,
        ]);
    }
    public function actionTopUp(){
        $payment = new Payment([
            'page' => Payment::PAGE_TOP_UP,
        ]);
        $payment->initDefaultMethod();
        return $this->render('top-up',[
            'payment' => $payment
        ]);
    }
    public function actionDetail($transaction_code){
        return $this->render('detail');
    }
    public function actionWithdraw(){
        return $this->render('withdraw');
    }
    public function actionHistory(){
        $get = \Yii::$app->request->get();
        $walletS = new WalletService();
        $wallet = ArrayHelper::getValue($walletS->detailWalletClient(),'data',[]);
        $listTransaction = ArrayHelper::getValue($walletS->listTransaction($get,20,0),'data',[]);

        return $this->render('history',[
            'wallet' => $wallet,
            'trans' => $listTransaction
        ]);
    }
}